<!-- key section nunjuck -->

{% macro section(key, shared) %}

{% include "partials/shared/_section_intro.html" %}

{% for section in key.sections %}
<section class="section" aria-labelledby="{{ section.title | replace(r/[^A-Za-z0-9]/g, '-') }}">
  <h2 id="{{ section.title | replace(r/[^A-Za-z0-9]/g, '-') }}" class="section__title copy">
    {{ section.title }}
  </h2>

  <ul>
  {% for paragraph in section.paragraphs %}

    {% if paragraph.li %}
    <li class="section__li copy"> {{ paragraph.li | safe }} </li>
    {% endif %}
    {% if paragraph.pre %}
    <div role="group" aria-label="{{ shared.sections.example }}">
      <pre class="section__pre"><code class="language-{{ paragraph.preLang }}">{{ paragraph.pre }}</code></pre>
    </div>
    {% endif %}
    {% if paragraph.img %}
    <img src="{{ paragraph.img.src }}" alt="{{ paragraph.img.alt }}" class="section__img">
    {% endif %}
    {% if paragraph.example %}
    <div role="group" aria-label="{{ shared.sections.example }}">
      <pre class="section__pre"><code class="language-{{ paragraph.example.preLang }}">{{ paragraph.example.pre }}</code></pre>
      <div class="section__example">
        <button type="button" class="button section__play" data-audio="{{ paragraph.example.audio }}" aria-hidden="true">
          {{ paragraph.example.play }}
        </button>
        <div class="section__example-code">
          <span class="section__output">{{ shared.sections.output }}:</span>
          {{ paragraph.example.pre | safe }}
        </div> 
        <span class="section__transcript" aria-hidden="true">
          <span class="section__output">{{ shared.sections.audio }}:</span>
          “{{ paragraph.example.audio }}”
        </span>
      </div>
    </div>
    {% endif %}
  
  {% endfor %}
  </ul>

  {% if section.subs %}
  {% for sub in section.subs %}
  
    {% include "partials/shared/_section_sub.html" %}

  {% endfor %}
  {% endif %}

</section>
{% endfor %}

{% endmacro %}